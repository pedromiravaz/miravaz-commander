services:
  cloudflared:
    image: cloudflare/cloudflared:latest
    container_name: cloudflared
    restart: unless-stopped
    command: tunnel run
    environment:
      - TUNNEL_TOKEN=eyJhIjoiZTNkZDg5MmI3OTY2YmVmMjljM2YwZjRlMTBiYjI0Y2IiLCJ0IjoiMWQ3Y2NjMTUtMmJiMC00ZmY1LWJiZGYtMjM1MmZjMzMyMzcxIiwicyI6Ik1tRTROalkxT0dJdFlXTmhaaTAwWlRObUxXSmxOR0l0WTJSaU1qVTJOelF5WW1VNSJ9
    networks:
      - miravaz-net

  commander:
    image: ghcr.io/pedromiravaz/miravaz-commander:latest
    container_name: commander
    restart: always
    # --- MISSING LINES ADDED BELOW ---
    command: uvicorn main:app --host 0.0.0.0 --port 8000
    ports:
      - "8000:8000" # Required if you want to test http://localhost:8000
    # ---------------------------------
    networks:
      - miravaz-net

  watchtower:
    image: containrrr/watchtower
    container_name: watchtower
    command: --interval 300
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock # Watchtower NEEDS this to work
    networks:
      - miravaz-net

networks:
  miravaz-net:
    driver: bridge
